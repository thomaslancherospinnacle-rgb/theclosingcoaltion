<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>MI Life Exam Practice</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#0b1220;
  color:#eaf2ff;
  padding:20px;
}
.card{
  max-width:900px;
  margin:auto;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  padding:20px;
}
h1{margin-top:0}
.row{margin-bottom:14px}
input{
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  background:#000;
  color:#fff;
  width:120px;
}
button{
  padding:12px 16px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:#22c55e;
  color:#000;
  font-weight:800;
  cursor:pointer;
}
button.secondary{background:#111;color:#fff}
.choice{
  display:block;
  padding:10px;
  border:1px solid rgba(255,255,255,.15);
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
}
.choice:hover{background:rgba(255,255,255,.1)}
.choice.correct{border-color:#22c55e;color:#22c55e}
.choice.wrong{border-color:#ff5a7a;color:#ff5a7a}
#timer{font-weight:800}
.hidden{display:none}
</style>
</head>

<body>

<div class="card">

<h1>MI Life Insurance Practice Exam</h1>

<div class="row">
  Total questions available:
  <b id="totalCount">â€”</b>
</div>

<div class="row">
  How many questions do you want?
  <input id="countInput" type="number" min="1">
</div>

<div class="row">
  <button id="startBtn">Start Exam</button>
</div>

<hr>

<div id="exam" class="hidden">
  <div class="row">
    <b>Time:</b> <span id="timer">0:00</span>
  </div>

  <div class="row">
    <b id="qIndex"></b>
  </div>

  <div class="row" id="questionText"></div>

  <div id="choices"></div>

  <div class="row">
    <button id="nextBtn" class="secondary">Next</button>
  </div>
</div>

<hr>

<div id="result" class="hidden">
  <h2>Exam Complete</h2>
  <div><b>Score:</b> <span id="scoreOut"></span></div>
  <div><b>Time:</b> <span id="timeOut"></span></div>
</div>

</div>

<!-- LOAD QUESTION BANK -->
<script src="miexam.js"></script>

<script>
/***************
 STATE
***************/
let questions = [];
let picked = [];
let index = 0;
let correct = 0;
let startTime;
let timerInt;

/***************
 HELPERS
***************/
function shuffle(arr){
  return arr.map(v=>[Math.random(),v]).sort().map(v=>v[1]);
}
function fmtTime(sec){
  const m = Math.floor(sec/60);
  const s = sec%60;
  return m+":"+(s<10?"0":"")+s;
}

/***************
 INIT
***************/
const totalCountEl = document.getElementById("totalCount");
const countInput = document.getElementById("countInput");

questions = window.MI_EXAM_QUESTIONS || [];
totalCountEl.textContent = questions.length;
countInput.max = questions.length;

/***************
 EXAM LOGIC
***************/
document.getElementById("startBtn").onclick = () => {
  const n = Number(countInput.value);
  if (!n || n < 1 || n > questions.length){
    alert("Enter a valid number");
    return;
  }

  picked = shuffle([...questions]).slice(0,n);
  index = 0;
  correct = 0;

  document.getElementById("exam").classList.remove("hidden");
  document.getElementById("result").classList.add("hidden");

  startTime = Date.now();
  timerInt = setInterval(()=>{
    const sec = Math.floor((Date.now()-startTime)/1000);
    document.getElementById("timer").textContent = fmtTime(sec);
  },1000);

  showQuestion();
};

function showQuestion(){
  const q = picked[index];
  document.getElementById("qIndex").textContent =
    `Question ${index+1} of ${picked.length}`;
  document.getElementById("questionText").textContent = q.question;

  const choices = shuffle([q.correct, ...q.wrongs]);
  const wrap = document.getElementById("choices");
  wrap.innerHTML = "";

  choices.forEach(c=>{
    const div = document.createElement("div");
    div.className="choice";
    div.textContent=c;
    div.onclick=()=>{
      if (div.dataset.done) return;
      div.dataset.done = "1";

      if (c === q.correct){
        div.classList.add("correct");
        correct++;
      } else {
        div.classList.add("wrong");
      }

      [...wrap.children].forEach(x=>x.style.pointerEvents="none");
    };
    wrap.appendChild(div);
  });
}

document.getElementById("nextBtn").onclick = () => {
  index++;
  if (index >= picked.length){
    finishExam();
  } else {
    showQuestion();
  }
};

function finishExam(){
  clearInterval(timerInt);
  document.getElementById("exam").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");

  const totalTime = Math.floor((Date.now()-startTime)/1000);
  document.getElementById("scoreOut").textContent =
    `${correct} / ${picked.length} (${Math.round(correct/picked.length*100)}%)`;
  document.getElementById("timeOut").textContent = fmtTime(totalTime);

  // ðŸ”´ THIS is where later you POST to GS:
  // correct, picked.length, totalTime
}
</script>

</body>
</html>
